#!/bin/bash

uuencode=1
binary=0
hakemisto="/tmp/konttiraspi"
function untar_payload()
{
        rm -rf $hakemisto
        mkdir -p $hakemisto
        match=$(grep --text --line-number '^PAYLOAD:$' $0 | cut -d ':' -f 1)
        payload_start=$((match + 1))
        if [[ $binary -ne 0 ]]; then
                tail -n +$payload_start $0 | tar -xf - -C $hakemisto
        fi
        if [[ $uuencode -ne 0 ]]; then
                tail -n +$payload_start $0 | uudecode | tar -xf - -C $hakemisto
        fi
}
#### onko tarpeelliset paketit asennettu jo? ###
### varmistetaan onko tarpeelliset paketit asennettu ###
paketit=(moreutils sharutils dialog)
asennetut=$(sudo dpkg-query -l)
asennettavat=""
for paketti in "${paketit[@]}";do
    asennettu=$(echo $asennetut |grep "${paketti}")
    if [[ ${#asennettu} == 0 ]];then
        echo asennetaan paketti $paketti
        asennettavat="$asennettavat $paketti"
    fi
done
if [[ ${#asennettavat} != 0 ]];then
    sudo apt update
    sudo apt install -y $asennettavat
fi

untar_payload
cd $hakemisto/deb
chmod a+x asenna
./asenna
exit 0

